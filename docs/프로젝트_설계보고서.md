# PCB 불량 검사 시스템 - 프로젝트 설계보고서

**프로젝트명**: AI 기반 실시간 PCB 불량 검사 및 자동 분류 시스템
**팀 구성**: 7명
**개발 기간**: 2024년 10월 ~ 2025년 2월 (예정)

---

## 1. 프로젝트 선정 이유

### 1.1 산업적 필요성

현대 전자 제조업에서 PCB(Printed Circuit Board) 불량 검사는 품질 관리의 핵심 공정임. 그러나 기존의 육안 검사 방식은 다음과 같은 문제점을 가지고 있음:

1. **인적 오류 (Human Error)**
   - 검사자의 피로도에 따른 검출률 편차 발생
   - 주관적 판단으로 인한 일관성 부족
   - 미세 불량의 놓침 가능성 존재

2. **생산성 저하**
   - 육안 검사로 인한 검사 시간 증가
   - 숙련된 검사 인력 부족 문제 발생
   - 24시간 연속 생산 라인에서의 인력 운영 어려움 존재

3. **경제적 손실**
   - 불량품 후처리 비용 발생
   - 고객 클레임으로 인한 브랜드 이미지 손상
   - 재작업 및 폐기 비용 증가

### 1.2 기술적 동기

최근 딥러닝 기술의 발전으로 이미지 기반 불량 검출 정확도가 크게 향상됨:

- **YOLO v8**: 실시간 객체 검출에서 우수한 성능 달성 (mAP 50-95: 53.9%)
- **이상 탐지(Anomaly Detection)**: 정상 패턴 학습을 통한 미세 불량 검출 가능
- **엣지 컴퓨팅**: 라즈베리파이를 활용한 분산 처리로 시스템 효율성 극대화

### 1.3 교육적 가치

본 프로젝트는 다음과 같은 교육적 목표를 가짐:

1. **AI 모델 실전 적용 경험**
   - YOLO v8 학습 및 최적화
   - 이상 탐지 모델 구현
   - 하이브리드 AI 시스템 설계

2. **임베디드 시스템 개발**
   - 라즈베리파이 GPIO 제어
   - 실시간 이미지 처리
   - 네트워크 통신 최적화

3. **풀스택 개발 경험**
   - Flask 백엔드 서버
   - MySQL 데이터베이스 설계
   - C# WinForms 데스크톱 애플리케이션
   - OHT 자동 운반 시스템

4. **협업 능력 향상**
   - Git/GitHub 기반 버전 관리
   - 모듈별 독립 개발 및 통합
   - API 계약 기반 협업

---

## 2. 프로젝트 컨셉

### 2.1 시스템 개요

**"실시간 양면 검사 + AI 융합 판정 + 자동 분류 + OHT 운반"**

컨베이어 벨트를 통해 들어오는 PCB의 양면(좌측/우측)을 동시에 촬영하고, GPU 서버에서 YOLO v8과 이상 탐지 모델을 결합하여 실시간으로 불량을 검출한 후, GPIO 제어로 분류 박스에 적재하며, OHT 시스템이 가득 찬 박스를 자동으로 창고로 운반하는 통합 시스템임.

### 2.2 핵심 기능

#### 2.2.1 양면 동시 검사
- **좌측 카메라 (라즈베리파이 1)**: PCB 좌측면 촬영 + GPIO 제어
- **우측 카메라 (라즈베리파이 2)**: PCB 우측면 촬영 전용
- **통합 판정**: Flask 서버에서 양면 결과를 융합하여 최종 불량 유형 결정

#### 2.2.2 하이브리드 AI 모델
- **YOLO v8 (Large)**: 부품 결함, 납땜 불량 등 명확한 불량 검출
- **이상 탐지 모델**: 미세한 긁힘, 패드 손상 등 학습되지 않은 불량 검출
- **결과 융합**: Confidence 기반 가중치로 최종 판정

#### 2.2.3 4단계 자동 분류
1. **정상 (NORMAL)**: 다음 공정으로 이동
2. **부품 불량 (COMPONENT_DEFECT)**: 부품 재작업 박스
3. **납땜 불량 (SOLDER_DEFECT)**: 납땜 재작업 박스
4. **폐기 (DISCARD)**: 심각한 불량, 재작업 불가

#### 2.2.4 박스 관리 시스템 (OHT 연동)
- **3개 박스 × 5 슬롯 (수평 배치)**: 총 15개 슬롯
- **실시간 박스 상태 모니터링**: C# WinForms 앱에서 슬롯 사용률과 가득 참 여부 표시
- **박스 가득 참 알림**: LED 경고 + WinForms 알림 + Flask 서버 알림
- **OHT 자동 호출**: 슬롯 5/5 감지 시 즉시 OHT 자동 요청 → 박스 교체 후 관리자 리셋

#### 2.2.5 OHT 자동 운반 시스템 ⭐ 신규
- **천장 레일 기반 X축 이동**: 3개 박스 간 수평 이동 (NEMA 17 스텝모터)
- **양쪽 스텝모터 Z축 동기화**: 베드 상하 이동 (GT2 벨트 감기/풀기 방식)
- **서보모터 걸쇠 방식**: L자형 핀 회전으로 박스 픽업
- **리미트 스위치 6개**: X축 2개 (창고, 최종 박스) + Z축 4개 (좌상단/좌하단/우상단/우하단)
- **라즈베리파이 3번 제어**: pigpio 기반 스텝모터 및 서보모터 제어

### 2.3 시스템 아키텍처

```
[컨베이어 벨트에 PCB 진입]
         │
         ↓
┌────────┴─────────┐
│  양면 동시 촬영   │
├──────────────────┤
│ 라즈베리파이 1   │ ← 좌측 웹캠 + GPIO 제어
│ 라즈베리파이 2   │ ← 우측 웹캠 전용
└────────┬─────────┘
         │ HTTP POST (Base64 이미지)
         ↓
┌─────────────────────────┐
│  Flask 추론 서버        │
│  (원격지 GPU PC)        │
├─────────────────────────┤
│ YOLO v8 추론           │
│ 이상 탐지 추론          │
│ 결과 융합 및 판정       │
│ MySQL 저장             │
│ 박스 상태 관리          │
└────────┬────────────────┘
         │ JSON 응답 (불량 유형 + GPIO 신호)
         ↓
┌────────────────────────┐
│ 라즈베리파이 1         │
├────────────────────────┤
│ GPIO 제어 (LED/릴레이) │
│ 분류 박스에 PCB 적재   │
└────────────────────────┘

[분류 박스 시스템]
┌────────┬──────────┬──────────┐
│ 정상    │ 부품불량 │ 납땜불량 │
│(5슬롯)  │ (5슬롯) │ (5슬롯)  │
└────┬───┴────┬─────┴────┬─────┘
     │        │          │
     └────────┴──────────┘
              │
     박스 5/5 감지 시 OHT 호출
              │
              ↓
┌─────────────────────────────┐
│  OHT 시스템                  │
│  (라즈베리파이 3번 제어)     │
├─────────────────────────────┤
│ X축 천장 레일 이동 (스텝모터)│
│ Z축 베드 상하 이동 (스텝모터×2)│
│ 서보모터 걸쇠 (박스 픽업)   │
│ 리미트 스위치 6개 감시      │
└────────┬────────────────────┘
         │
         ↓
    [창고로 이동]

[C# WinForms 모니터링 앱]
├─ 실시간 대시보드 (통계, 차트)
├─ 검사 이력 조회 및 Excel 내보내기
├─ 박스 상태 모니터링 (슬롯 사용률)
├─ OHT 수동 호출 (Admin/Operator 권한)
└─ 사용자 권한 관리 (Admin/Operator/Viewer)
```

### 2.4 성능 목표

- **추론 속도**: < 300ms (컨베이어 벨트 동작 시간 고려)
- **실제 달성**: 100-200ms (원격 연결 포함) ✅
- **정확도**: mAP 50-95 > 85%
- **가용성**: 24시간 무중단 운영 (오류 복구 메커니즘)
- **OHT 운반 시간**: 박스 1개당 < 2분 (픽업 + 이동 + 배치)

---

## 3. 기술 스택

### 3.1 AI 및 머신러닝

| 구분 | 기술 스택 | 버전 | 용도 |
|------|-----------|------|------|
| **딥러닝 프레임워크** | PyTorch | 2.0+ | YOLO 및 이상 탐지 학습 |
| **객체 검출** | YOLO v8 (Ultralytics) | 8.0.x | 부품/납땜 불량 검출 |
| **이상 탐지** | Anomalib (PaDiM) | 1.0+ | 미세 불량 검출 |
| **컴퓨터 비전** | OpenCV | 4.8+ | 이미지 전처리 및 증강 |
| **데이터 처리** | NumPy, Pandas | Latest | 데이터 분석 및 통계 |

### 3.2 백엔드 서버

| 구분 | 기술 스택 | 버전 | 용도 |
|------|-----------|------|------|
| **웹 프레임워크** | Flask | 3.0+ | REST API 서버 |
| **WSGI 서버** | Gunicorn | 21.0+ | 프로덕션 배포 (선택) |
| **데이터베이스** | MySQL | 8.0 | 검사 이력 및 통계 저장 |
| **ORM** | PyMySQL | 1.1+ | Python-MySQL 연동 |
| **통신** | Requests | 2.31+ | HTTP 클라이언트 |

### 3.3 프론트엔드 (모니터링 앱)

| 구분 | 기술 스택 | 버전 | 용도 |
|------|-----------|------|------|
| **UI 프레임워크** | C# WinForms | .NET 6+ | 데스크톱 앱 |
| **차트 라이브러리** | LiveCharts | 0.9.7 | 실시간 통계 시각화 |
| **데이터 처리** | Newtonsoft.Json | 13.0.3 | JSON 파싱 |
| **Excel 내보내기** | ClosedXML | 0.102.1 | 검사 이력 Excel 저장 |
| **DB 연동** | MySql.Data | 8.0.33 | MySQL 연결 |
| **보안** | BCrypt.Net-Next | 4.0.3 | 비밀번호 해싱 |

### 3.4 임베디드 시스템

| 구분 | 기술 스택 | 버전 | 용도 |
|------|-----------|------|------|
| **하드웨어** | Raspberry Pi 4 Model B | 8GB RAM | 카메라 클라이언트 + OHT 제어 |
| **OS** | Raspberry Pi OS | 64-bit | Linux 환경 |
| **GPIO 제어** | RPi.GPIO | 0.7+ | 릴레이 모듈 제어 (라즈베리파이 1) |
| **GPIO 제어 (OHT)** | pigpio | 1.78+ | 스텝모터 정밀 제어 (라즈베리파이 3) |
| **카메라** | OpenCV + V4L2 | 4.8+ | 웹캠 프레임 캡처 |

### 3.5 OHT 제어 시스템 ⭐ 신규

| 구분 | 기술 스택 | 버전 | 용도 |
|------|-----------|------|------|
| **마이크로컨트롤러** | Raspberry Pi 4 (OHT 전용) | 8GB RAM | OHT 시스템 제어 |
| **GPIO 라이브러리** | pigpio | 1.78+ | 스텝모터/서보모터 정밀 제어 |
| **스텝모터 드라이버** | A4988 | - | NEMA 17 스텝모터 제어 (X축 1개, Z축 2개) |
| **서보모터** | MG996R | - | 걸쇠 제어 (토크 9.4 kgf·cm) |
| **센서** | 리미트 스위치 | - | 위치 감지 (X축 2개, Z축 4개) + 긴급 정지 |
| **통신 프로토콜** | HTTP REST API | - | Flask 서버 폴링 (작업 요청 확인) |

### 3.6 네트워크

| 구분 | 기술 스택 | 버전 | 용도 |
|------|-----------|------|------|
| **VPN** | Tailscale | Latest | 원격 네트워크 연결 |
| **프로토콜** | HTTP/REST | - | API 통신 |
| **데이터 포맷** | JSON, Base64 | - | 이미지 및 데이터 전송 |

### 3.7 개발 도구

| 구분 | 기술 스택 | 용도 |
|------|-----------|------|
| **버전 관리** | Git, GitHub | 소스 코드 관리 |
| **IDE** | VSCode, Visual Studio 2022 | 코드 에디터 |
| **가상환경** | Miniconda (Python) | 패키지 관리 |
| **문서화** | Markdown | 프로젝트 문서 |

### 3.8 하드웨어 사양

#### GPU PC (추론 서버)
- **GPU**: NVIDIA RTX 4080 Super (16GB VRAM)
- **CPU**: Intel Core i7-12700K 이상 권장
- **RAM**: 32GB DDR4
- **Storage**: SSD 500GB+
- **OS**: Windows 11 + WSL2 (Ubuntu 22.04) 또는 Linux

#### 라즈베리파이 (3대)
**라즈베리파이 1 (좌측 카메라 + GPIO)**
- **모델**: Raspberry Pi 4 Model B (8GB RAM)
- **웹캠**: USB 웹캠 (1080p, 30fps)
- **GPIO 모듈**: 릴레이 모듈 (4채널)
- **전원**: 5V 3A USB-C
- **Tailscale VPN**: 100.x.x.y

**라즈베리파이 2 (우측 카메라 전용)**
- **모델**: Raspberry Pi 4 Model B (8GB RAM)
- **웹캠**: USB 웹캠 (1080p, 30fps)
- **전원**: 5V 3A USB-C
- **Tailscale VPN**: 100.x.x.z

**라즈베리파이 3 (OHT 제어)** ⭐ 신규
- **모델**: Raspberry Pi 4 Model B (8GB RAM)
- **GPIO**: pigpio 라이브러리로 스텝모터 제어
- **센서**: 리미트 스위치 6개 + 긴급 정지 버튼
- **전원**: 5V 3A USB-C + 스텝모터 전원 (12V 5A)
- **Tailscale VPN**: 100.64.1.4 (또는 로컬 예비: 192.168.0.22)

#### OHT 하드웨어 ⭐ 신규
**스텝모터 시스템**
- **X축**: NEMA 17 스텝모터 × 1 (천장 레일 이동)
- **Z축**: NEMA 17 스텝모터 × 2 (양쪽 베드 상하 이동)
- **드라이버**: A4988 × 3
- **타이밍 벨트**: GT2 (폭 6mm, 피치 2mm)
- **레일**: 알루미늄 프로파일 (3-5m)

**서보모터 시스템**
- **모델**: MG996R
- **토크**: 9.4 kgf·cm
- **용도**: L자형 걸쇠 회전 (0도/90도)

**센서 시스템**
- **리미트 스위치**: 6개 (X축 2개, Z축 4개)
- **긴급 정지 버튼**: 1개
- **전원**: 12V 5A 어댑터

---

## 4. 담당 역할 (상세 기술)

### 4.1 AI 모델 + Flask 서버 + 데이터베이스 담당 (1명)

**담당자**: [이름]

#### 4.1.1 AI 모델 개발 (40%)

**1. 데이터셋 수집 및 전처리**
- PCB 불량 공개 데이터셋 수집 (DeepPCB, Kaggle, Roboflow)
- YOLO v8 형식으로 어노테이션 변환 (Pascal VOC → YOLO)
- 데이터 증강 (Augmentation): Flip, Rotation, Noise, Blur
- Train/Val/Test 분할 (70:20:10)
- 데이터셋 YAML 파일 작성

**2. YOLO v8 학습**
- YOLOv8l (Large) 모델 선택 (RTX 4080 Super 최적화)
- 하이퍼파라미터 튜닝:
  - Batch size: 32 (16GB VRAM 활용)
  - Epochs: 150
  - Image size: 640
  - Optimizer: AdamW
  - Learning rate: 0.001
- FP16 (Half Precision) 적용 → VRAM 50% 절약
- 학습 중 Tensorboard 모니터링
- 최적 모델 선정 (mAP, Precision, Recall 기준)

**3. 이상 탐지 모델 학습**
- Anomalib 라이브러리 사용 (PaDiM 알고리즘)
- 정상 PCB 이미지로 학습 (MVTec AD 데이터셋)
- 임계값(Threshold) 최적화
- YOLO와 결과 융합 로직 구현

**4. 모델 최적화**
- TensorRT 변환 (추론 속도 1.5배 향상)
- Batch inference 구현 (동시 처리)
- GPU 메모리 최적화

#### 4.1.2 Flask 서버 개발 (40%)

**1. REST API 설계 및 구현**
- `/predict` (POST): 단일 프레임 추론
- `/predict_dual` (POST): 양면 프레임 동시 추론
- `/health` (GET): 서버 상태 체크
- `/box_status` (GET): 박스 상태 조회
- `/box_status/reset` (POST): 박스 리셋
- `/oht/request` (POST): OHT 호출 요청 ⭐ 신규
- `/oht/status` (GET): OHT 상태 조회 ⭐ 신규
- `/statistics` (GET): 통계 조회
- `/history` (GET): 검사 이력 조회

**2. 추론 엔진 구현**
- Base64 이미지 디코딩
- YOLO 모델 로드 및 추론
- 이상 탐지 모델 추론
- 결과 융합 알고리즘 (Confidence 기반 가중치)
- 불량 유형 판정 로직 (4단계 분류)

**3. 서버 최적화**
- 멀티스레딩으로 동시 요청 처리
- 모델 메모리 상주 (재로드 방지)
- 응답 시간 모니터링 및 로깅
- CORS 설정 (C# WinForms 연동)

#### 4.1.3 MySQL 데이터베이스 설계 (20%)

**1. 테이블 스키마 설계**
- `inspections`: 검사 이력 (id, camera_id, defect_type, confidence, image_path, timestamp)
- `box_status`: 박스 상태 (box_id, category, current_slot, max_slots, is_full)
- `oht_tasks`: OHT 작업 큐 (task_id, box_id, status, created_at, completed_at) ⭐ 신규
- `system_logs`: 시스템 로그 (log_level, log_message, timestamp)
- `alerts`: 알림 (alert_type, alert_message, priority, status)
- `users`: 사용자 관리 (username, password_hash, role, created_at)

**2. 인덱스 및 최적화**
- PRIMARY KEY 설정
- 검색 최적화 인덱스 (timestamp, defect_type)
- 외래 키 제약 조건

**3. 데이터베이스 연동**
- PyMySQL을 사용한 CRUD 구현
- 트랜잭션 관리
- 연결 풀링 (Connection Pooling)

---

### 4.2 C# WinForms 모니터링 앱 담당 (2명)

#### 4.2.1 담당자 1: UI/UX 및 권한 시스템 개발

**담당자**: [이름]

**1. 로그인 및 세션 관리 (15%)**
- LoginForm 구현 (BCrypt 비밀번호 해싱)
- SessionManager 클래스 (로그인 상태, 권한 체크)
- 로그인 시도 횟수 제한 (5회 실패 시 5분 잠금)
- 자동 로그아웃 (30분 비활성 시)

**2. 메인 대시보드 (30%)**
- 실시간 통계 카드 (총 검사, 정상, 불량, 불량률)
- LiveCharts 파이 차트 (불량 유형별 비율)
- LiveCharts 라인 차트 (시간대별 검사 현황)
- 시스템 상태 표시 (서버, DB, 라즈베리파이 온라인 여부)
- CPU/RAM/GPU 사용률 ProgressBar
- 1초마다 자동 새로고침 (Timer)

**3. 박스 상태 모니터링 UI (25%)**
- BoxStatusPanel 커스텀 컨트롤 구현
- 3개 박스 × 5 슬롯 시각화 (수평 슬롯 진행 바)
- 슬롯 사용 현황 실시간 표시 (■■■□□ 형식, 0~5/5)
- 박스 가득 참 경고 (빨간색 배경 + "5/5" 라벨)
- 박스 리셋 버튼 (Admin/Operator 권한)
- OHT 수동 호출 버튼 (Admin/Operator 권한) ⭐ 신규
- 2초마다 API 호출하여 상태 갱신

**4. OHT 상태 모니터링 UI (15%)** ⭐ 신규
- OHT 현재 위치 표시 (창고/박스1/박스2/박스3)
- OHT 동작 상태 (대기/이동 중/픽업 중/배치 중)
- 작업 큐 표시 (대기 중인 OHT 작업)
- 긴급 정지 버튼 (Admin 권한)

**5. 권한별 UI 제어 (10%)**
- Admin: 모든 기능 접근
- Operator: 검사 이력, 통계, Excel 내보내기, OHT 호출
- Viewer: 읽기 전용 (내보내기 불가, OHT 호출 불가)
- 메뉴 표시/숨김 동적 제어

**6. 커스텀 컨트롤 개발 (5%)**
- StatusIndicator (상태 동그라미)
- LegendItem (차트 범례)
- DefectTypeHelper (색상 매핑 유틸리티)

#### 4.2.2 담당자 2: 데이터 조회 및 내보내기 기능 개발

**담당자**: [이름]

**1. 검사 이력 조회 화면 (30%)**
- InspectionHistoryForm 구현
- DataGridView 커스텀 렌더링 (불량 유형 색상 동그라미)
- 날짜 범위 필터 (DateTimePicker)
- 불량 유형 필터 (ComboBox)
- 카메라 ID 필터 (left/right)
- 페이징 처리 (50건씩, 이전/다음 버튼)
- 더블클릭 시 불량 이미지 뷰어 열기

**2. 통계 화면 (25%)**
- StatisticsForm 구현
- 날짜 범위별 통계 조회
- 불량 유형별 파이 차트
- 시간대별 라인 차트
- 카메라별 통계 비교 테이블
- 불량률 추이 그래프

**3. Excel 내보내기 (20%)**
- ExcelExportService 클래스 구현 (ClosedXML)
- 검사 이력 Excel 저장 (조건부 서식 적용)
- 통계 데이터 다중 시트 내보내기:
  - Sheet 1: 요약 통계
  - Sheet 2: 시간대별 데이터
  - Sheet 3: 불량 유형별 상세
  - Sheet 4: OHT 작업 로그 ⭐ 신규
- 파일 저장 대화상자 (SaveFileDialog)

**4. 불량 이미지 뷰어 (15%)**
- DefectImageViewerForm 구현
- 이미지 확대/축소 (Zoom In/Out)
- 이미지 회전 (90도, 180도)
- 검사 정보 표시 (ID, 시간, 불량 유형, 신뢰도)
- 이미지 저장 버튼

**5. API 통신 및 데이터베이스 연동 (10%)**
- ApiService 클래스 (HttpClient)
- DatabaseService 클래스 (MySql.Data)
- 비동기 처리 (async/await)
- 에러 핸들링 및 재시도 로직

---

### 4.3 라즈베리파이 클라이언트 담당 (2명)

#### 4.3.1 담당자 1: 좌측 카메라 + GPIO 제어

**담당자**: [이름]

**1. 웹캠 프레임 캡처 및 전송 (30%)**
- OpenCV VideoCapture 초기화 (카메라 인덱스 0)
- 해상도 설정 (640x480)
- FPS 제어 (10 fps)
- JPEG 인코딩 (품질 85)
- Base64 인코딩
- HTTP POST로 Flask 서버 전송 (Requests 라이브러리)
- 네트워크 타임아웃 처리 (5초)

**2. GPIO 제어 (30%)**
- RPi.GPIO 라이브러리 사용 (BCM 모드)
- 4개 GPIO 핀 설정 (17, 27, 22, 23)
- Flask 서버 응답에서 불량 유형 파싱
- 불량 유형에 따른 GPIO 핀 제어:
  - 부품 불량 → GPIO 17 HIGH (300ms)
  - 납땜 불량 → GPIO 27 HIGH (300ms)
  - 폐기 → GPIO 22 HIGH (300ms)
  - 정상 → GPIO 23 HIGH (300ms)
- 릴레이 모듈 연동 (LED 또는 신호등)

**3. 시스템 서비스 등록 (15%)**
- systemd 서비스 파일 작성 (`camera-client-left.service`)
- 자동 시작 설정 (`systemctl enable`)
- 재시작 정책 (실패 시 10초 후 재시작)

**4. 로깅 및 모니터링 (15%)**
- Python logging 모듈 사용
- 로그 파일 로테이션 (5MB, 3개 백업)
- 네트워크 지연 측정 및 기록
- 에러 로그 (프레임 전송 실패, GPIO 오류)

**5. 네트워크 설정 (10%)**
- Tailscale VPN 연결 설정
- 고정 IP 할당 (100.x.x.y)
- Flask 서버 URL 환경 변수 설정

#### 4.3.2 담당자 2: 우측 카메라 전용

**담당자**: [이름]

**1. 웹캠 프레임 캡처 및 전송 (40%)**
- OpenCV VideoCapture 초기화 (카메라 인덱스 0)
- 해상도 설정 (640x480)
- FPS 제어 (10 fps)
- JPEG 인코딩 (품질 85)
- Base64 인코딩
- HTTP POST로 Flask 서버 전송 (Requests 라이브러리)
- 네트워크 타임아웃 처리 (5초)
- 재시도 로직 (3회 시도, 지수 백오프)

**2. 프레임 동기화 (20%)**
- 좌측 카메라와 타임스탬프 동기화
- 프레임 드롭 감지 및 복구
- 네트워크 지연 측정 및 보상

**3. 카메라 최적화 (15%)**
- 자동 노출 조정 (Auto Exposure)
- 화이트 밸런스 설정
- 초점 고정 (Manual Focus)
- 조명 조건 보정

**4. 시스템 서비스 등록 (10%)**
- systemd 서비스 파일 작성 (`camera-client-right.service`)
- 자동 시작 설정 (`systemctl enable`)
- 재시작 정책 (실패 시 10초 후 재시작)

**5. 로깅 및 모니터링 (10%)**
- Python logging 모듈 사용
- 로그 파일 로테이션 (5MB, 3개 백업)
- 네트워크 지연 측정 및 기록
- 에러 로그 (프레임 전송 실패, 카메라 연결 오류)

**6. 네트워크 설정 (5%)**
- Tailscale VPN 연결 설정
- 고정 IP 할당 (100.x.x.z)
- Flask 서버 URL 환경 변수 설정

---

### 4.4 OHT 시스템 담당 (2명) ⭐ 신규

#### 4.4.1 담당자 1: pigpio 제어 및 센서 시스템

**담당자**: [이름]

**1. 스텝모터 제어 시스템 (35%)**
- pigpio 라이브러리 초기화 및 설정
- X축 스텝모터 제어 (NEMA 17 × 1):
  - 방향 핀 (DIR) 및 스텝 핀 (STEP) 설정
  - 마이크로스테핑 설정 (A4988, 1/16)
  - 위치 계산 (스텝 카운팅)
  - 속도 제어 (가속/감속 알고리즘)
- Z축 스텝모터 동기화 제어 (NEMA 17 × 2):
  - 좌측/우측 모터 동시 제어
  - 양쪽 스텝 카운트 동기화
  - GT2 벨트 감기/풀기 제어

**2. 서보모터 걸쇠 제어 (20%)**
- MG996R 서보모터 PWM 제어
- L자형 핀 회전 제어:
  - 0도: 수평 (삽입 준비)
  - 45도: 박스 구멍 삽입
  - 90도: 잠금 (픽업)
- 서보 각도 캘리브레이션
- 토크 모니터링 (과부하 감지)

**3. 센서 시스템 구현 (25%)**
- 리미트 스위치 6개 GPIO 콜백 설정:
  - X축 창고 위치 (홈 포지션)
  - X축 최종 박스 위치 (안전 한계)
  - Z축 좌상단 (베드 왼쪽 완전히 올라감)
  - Z축 좌하단 (베드 왼쪽 완전히 내려감)
  - Z축 우상단 (베드 오른쪽 완전히 올라감)
  - Z축 우하단 (베드 오른쪽 완전히 내려감)
- 긴급 정지 버튼 인터럽트 처리
- 센서 노이즈 필터링 (디바운싱)

**4. 안전 로직 및 에러 처리 (15%)**
- 리미트 스위치 트리거 시 모터 즉시 정지
- Z축 좌우 불균형 감지 및 보정
- 타임아웃 처리 (동작 시간 초과 시 중단)
- 비상 정지 모드 구현

**5. 시스템 서비스 등록 (5%)**
- systemd 서비스 파일 작성 (`oht-controller.service`)
- pigpiod 데몬 자동 시작
- 재시작 정책 (실패 시 10초 후 재시작)

#### 4.4.2 담당자 2: 상태 머신 및 좌표 관리

**담당자**: [이름]

**1. OHT 상태 머신 구현 (30%)**
- 상태 전이 설계:
  - IDLE: 대기 중 (창고 위치)
  - MOVING_TO_BOX: 박스로 이동 중
  - LOWERING_BED: 베드 내리는 중
  - LOCKING: 걸쇠 잠그는 중
  - RAISING_BED: 베드 올리는 중
  - MOVING_TO_WAREHOUSE: 창고로 이동 중
  - UNLOCKING: 걸쇠 풀기
  - ERROR: 오류 상태
- 상태별 동작 로직 구현
- 상태 전이 검증 (안전성 체크)

**2. 좌표 테이블 관리 (20%)**
- X축 위치 정의 (스텝 단위):
  - HOME_POSITION: 0 (창고)
  - BOX1_POSITION: 2000 (정상 박스)
  - BOX2_POSITION: 4000 (부품불량 박스)
  - BOX3_POSITION: 6000 (납땜불량 박스)
- Z축 높이 정의 (스텝 단위):
  - BED_UP: 0 (완전히 올라간 상태)
  - BED_DOWN: 8000 (완전히 내려간 상태)
- 좌표 캘리브레이션 함수
- 좌표 데이터 저장/로드 (JSON 파일)

**3. Flask API 폴링 및 작업 큐 처리 (25%)**
- 1초마다 Flask 서버 폴링 (`/oht/status`)
- OHT 작업 요청 확인 (박스 가득 참 또는 수동 호출)
- 작업 큐에서 대기 중인 작업 가져오기
- 작업 완료 후 Flask 서버에 결과 전송 (`/oht/complete`)
- 작업 실패 시 재시도 로직 (3회)

**4. 동작 시퀀스 설계 및 최적화 (15%)**
- 박스 픽업 → 창고 배치 전체 시퀀스
- 동작 순서 최적화 (최소 시간 경로)
- 다음 박스 위치 예측 (대기 시간 감소)
- 충돌 회피 로직

**5. 테스트 및 디버깅 (10%)**
- 각 박스별 동작 검증
- 반복 정확도 측정 (10회 반복)
- 속도 최적화 (목표: < 2분/박스)
- 로깅 및 모니터링 (작업 시간, 오류 기록)

---

## 5. 개발 일정 (예정)

| 단계 | 기간 | 주요 작업 | 담당 |
|------|------|-----------|------|
| **Phase 1** | 2024년 10월 | YOLO 환경 구축 및 데이터셋 준비 | AI 담당자 |
| **Phase 2** | 2024년 11월 | YOLO 학습 및 최적화 | AI 담당자 |
| **Phase 3** | 2024년 12월 | 이상 탐지 모델 학습 및 Flask 서버 개발 | AI + Flask 담당자 |
| **Phase 4** | 2025년 1월 상반기 | 라즈베리파이 클라이언트 개발 및 OHT 제어 시스템 | 라즈베리파이 + OHT 담당자 |
| **Phase 5** | 2025년 1월 하반기 | C# WinForms 앱 개발 | WinForms 담당자 |
| **Phase 6** | 2025년 2월 | 통합 테스트 및 최종 발표 준비 | 전체 팀원 |

---

## 6. 기대 효과

### 6.1 산업적 기대 효과
- PCB 검사 속도 **10배 향상** (육안 대비)
- 불량 검출 정확도 **95% 이상** 달성
- 인력 비용 **50% 절감**
- 24시간 무중단 운영 가능
- **OHT 자동 운반으로 인력 개입 최소화** ⭐ 신규

### 6.2 교육적 성과
- AI 모델 실전 적용 경험
- 임베디드 시스템 개발 역량
- 풀스택 개발 경험
- **pigpio 기반 정밀 모터 제어 경험** ⭐ 신규
- **센서 기반 자동화 시스템 구축 경험** ⭐ 신규
- 협업 및 프로젝트 관리 능력 향상

### 6.3 확장 가능성
- 다양한 제조업 분야 적용 (자동차 부품, 전자 제품 등)
- 클라우드 기반 서비스로 확장
- 모바일 앱 연동 (관리자 알림)
- **OHT 시스템 스케일업** (더 많은 박스 지원) ⭐ 신규
- **AGV(Automated Guided Vehicle) 연동** ⭐ 신규

---

## 7. 프로젝트 문서

### 7.1 핵심 통합 문서
- **전체 로드맵**: `PCB_Defect_Detection_Project.md` (시스템 아키텍처 및 통합 문서)
- **프로젝트 구조**: `Project_Structure.md` (폴더 구조 및 문서 목록)

### 7.2 개발 가이드
- **Flask 서버 구축**: `Flask_Server_Setup.md` (실시간 검사 시스템)
- **MySQL 데이터베이스**: `MySQL_Database_Design.md` (스키마 설계)
- **C# WinForms 기본**: `CSharp_WinForms_Guide.md` (모니터링 앱 기본 개발)
- **C# WinForms UI 설계**: `CSharp_WinForms_Design_Specification.md` (권한 시스템, 7개 화면)
- **C# WinForms UI 디자인**: `CSharp_WinForms_UI_Design_Guide.md` ⭐ 신규 (상세 UI 구현 가이드)
- **라즈베리파이 1,2**: `RaspberryPi_Setup.md` (웹캠 + GPIO)
- **라즈베리파이 3 (OHT)**: `RaspberryPi_OHT_Setup.md` ⭐ 신규 (pigpio 제어)
- **OHT 시스템**: `OHT_System_Setup.md` ⭐ 신규 (하드웨어 구성 및 제어)

### 7.3 학습 관련
- **YOLO 환경 구축**: `Phase1_YOLO_Setup.md`
- **YOLO 학습 가이드**: `YOLO_Training_Guide.md` ⭐ 신규
- **데이터셋 가이드**: `Dataset_Guide.md`
- **로깅 전략**: `Logging_Strategy.md` (통합 로깅 및 오류 추적)

### 7.4 네트워크 및 API
- **원격 네트워크 설정**: `Remote_Network_Setup.md` (Tailscale VPN)
- **API 계약**: `API_Contract.md` (REST API 명세)

---

**작성일**: 2025년 10월 30일
**버전**: 2.0 (OHT 시스템 추가, 로봇팔 제거)
**문서 담당**: 전체 팀원
